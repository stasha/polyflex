<link rel="import" href="../_imports/polymer.html" />
<link rel="import" href="../_imports/page.js.html" />

<link rel="import" href="../behaviors/CoreBehavior.html" />
<link rel="import" href="../behaviors/EventBehavior.html" />

<dom-module id="url-router">

	<script>
		(function (window, page) {

			"use strict";

			var polyflex = window.polyflex = window.polyflex || {};
			var behaviors = polyflex.behaviors = polyflex.behaviors || {};


			Polymer({
				is: "url-router",
				behaviors: [behaviors.CoreBehavior, behaviors.EventBehavior],
				properties: {
					base: {
						type: String,
						observer: "setBase"
					}
				},
				setBase: function (newValue) {
					if (newValue) {
						page.base(newValue);
						this.log("Setting base url to: " + newValue);
					}
				},
				created: function(){
					this.onMessage({
						channel: "page-route",
						route: "*",
						callback: function (context) {
							console.log("no route found");
						}
					});
					this.addRoute("*");
				},
				detached: function () {
					page.stop();
					this.log("Router stopped.");
				},
				addRoute: function (route) {

					var self = this;

					page(route, function (ctx) {
						// sends message that route has changed
						self.sendMessage({
							channel: "page-route",
							route: route,
							context: {context: ctx}
						});
					});

					page.start();
				}
			});

		})(window, window.page);
	</script>
</dom-module>
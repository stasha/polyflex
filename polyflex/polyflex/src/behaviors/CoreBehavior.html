<script>
	(function (window) {

		"use strict";
		var polyflex = window.polyflex = window.polyflex || {};
		var behaviors = polyflex.behaviors = polyflex.behaviors || {};
		var Event = polyflex.Event;
		/**
		 * Behavior containing core functionality.
		 * 
		 * @type type
		 */
		behaviors.CoreBehavior = {
			customElements: [behaviors.EventBehavior],
			isDetached: null,
			webComponentsReady: null,
			properties: {
				debug: {
					type: Boolean,
					value: false
				}
			},
			ready: function () {
				this.dispatchEvent(new CustomEvent("child-ready", {bubbles: true, cancelable: true}));
			},
			attached: function () {
				this.isDetached = false;
				this.dispatchEvent(new CustomEvent("child-added", {bubbles: true, cancelable: true}));
				this.customElements.push(this);
			},
			detached: function () {
				this.isDetached = true;
				this.customElements.splice(this.customElements.indexOf(this), 1);
				if (this._lightParent) {
					this._lightParent.dispatchEvent(new CustomEvent("child-removed", {bubbles: true, cancelable: true}));
				}
			},
			/**
			 * Returns true/false if component is in debug mode.
			 * 
			 * @returns {Boolean}
			 */
			get isInDebugMode() {
				return document.getElementsByTagName("html")[0].className.indexOf("debug") > -1;
			},
			/**
			 * Invoked when this comonent is ready.
			 * 
			 * @returns {undefined}
			 */
			created: function () {
				this.isDetached = true;
				try{
					this.one(window, Event.WEB_COMPONENTS_READY, this.componentsReady);
				} catch (e){
					console.warn("You should implement EventBehavior behavior in this component.");
				}
			},
			/**
			 * Invoked when all webcomponents are ready.
			 * 
			 * @returns {undefined}
			 */
			componentsReady: function () {
				this.webComponentsReady = true;
				console.log("webcomponents ready");
			},
			/**
			 * Returns body element
			 * 
			 * @returns {Element}
			 */
			get body() {
				return document.querySelector("body");
			},
			/**
			 * Returns if this element is displayed in th DOM or not.
			 * 
			 * @returns {Boolean}
			 */
			get isDisplayed() {
				var elm = this.arguments[0] || this;
				while (elm.tagName !== 'BODY') {
					if (elm.style.display === "none") {
						return false;
					}
					elm = elm.parentNode;
				}
				return true;
			},
			get polyflex() {
				return window.polyflex;
			},
			get channels() {
				return this.polyflex.channels;
			},
			get events() {
				return this.polyflex.events;
			},
			get urls() {
				return this.polyflex.urls;
			},
			/**
			 * Looks up for an object based on passed string path.
			 * Path example: "foo.bar.baz".
			 * 
			 * @param {String} path
			 * @param {Object} object - Object from where to start lookup. 
			 * If no object is specified, than lookup starts from window object.
			 * 
			 * @returns {Object}
			 */
			pathToObject: function (path, object) {
				// if object is not defined, than we start 
				// to bild a path from window object;
				var obj = object || window;
				var stack = path.split('.');
				while (stack.length > 0) {
					obj = obj[stack.shift()];
					if (!obj) {
						return null;
					}
				}

				return obj;
			},
			/**
			 * Logs messages if debug is set to true.
			 * 
			 * @param {type} arg
			 * @returns {undefined}
			 */
			log: function (arg) {
				if (this.debug || this.isInDebugMode) {
					console.log(arg);
				}
			},
			/**
			 * Converts string to array based on space or coma separator.
			 * 
			 * @param {type} str
			 * @returns {Array}
			 */
			stringToArray: function (str) {
				if (!str) {
					return [];
				}
				var normalizedStr = str.toString().replace(/,/g, " ");
				normalizedStr = normalizedStr.replace(/\s+/g, " ");
				var strArr = normalizedStr.split(" ");
				return strArr;
			},
			/**
			 * Prevents default behavior.
			 * 
			 * @param {type} e
			 * @returns {undefined}
			 */
			preventDefault: function (e) {
				if (e.currentTarget.customElement) {
					e.currentTarget.customElement.log("Preventing default behavior.");
				}
				e.preventDefault();
			}
		};
	})(window);

</script>